# ------------------------------
# STAGE 1: Build base
# ------------------------------
FROM node:18

# Establecer directorio de trabajo
WORKDIR /app

# Copiar solo archivos de dependencias primero (para cache)
COPY package*.json ./

# Instalar dependencias de producci贸n por defecto
RUN npm install

#  Aseg煤rate de copiar el script de espera
COPY wait-for-it.sh /wait-for-it.sh
RUN chmod +x /wait-for-it.sh

# Copiar el resto del c贸digo fuente
COPY . .

# Exponer el puerto que usar谩 la API
EXPOSE 3000

# ------------------------------
# STAGE 2: Entorno de ejecuci贸n
# ------------------------------
# 锔 Cambia este comando en producci贸n:
# CMD ["npm", "start"]

#  Comando por defecto para desarrollo
CMD ["npx", "nodemon", "server.js"]
